<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RMNCAH</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Tailwind CSS (with custom config using inline script) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',   // Custom Blue
                        secondary: '#f59e0b', // Custom Amber
                        accent: '#10b981',    // Custom Green
                        dark: '#1f2937',      // Gray-800
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="styles/main.css">
    <script src="./set-base-url.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tw-elements/css/tw-elements.min.css" />
    <script src="styles/main.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
        integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha384-sA+RlRzF8YK8EeQx09sEtc06CXi1K06oBJJSM6Ox9B8JeN5aZzffR28E/zTGmLXN" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha384-O3FJxqIQW2STXQKKFePx5FKP8uXpTYBJ+Al9VwZpyaXx1V4u1ZbE1cBGTSrBocjz" crossorigin=""></script>

    <!-- Auto-redirect for logged-in users -->
    <script src="auto-redirect.js"></script>

    <!-- Optional: Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        .fade-slide-enter {
            opacity: 0;
            transform: translateY(20px);
        }

        .fade-slide-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.4s ease;
        }

        .fade-slide-leave {
            opacity: 1;
            transform: translateY(0);
        }

        .fade-slide-leave-active {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
    </style>

</head>

<body class="text-gray-800 ">
    <nav x-data="{ open: false }"
        class="fixed z-50 border shadow-sm bg-white/70 top-4 left-4 right-4 backdrop-blur-md border-white/10 rounded-xl">
        <div class="flex items-center justify-between px-6 py-4">


            <!-- Mobile Menu Toggle -->
            <button @click="open = !open" class="text-xl lg:hidden focus:outline-none">
                <i class="fas fa-bars" x-show="!open"></i>
                <i class="fas fa-times" x-show="open" x-cloak></i>
            </button>

            <!-- Nav Links - Desktop -->
            <ul class="items-center hidden space-x-8 text-sm font-medium text-gray-700 lg:flex">

            </ul>
        </div>

        <!-- Nav Links - Mobile -->
        <div x-show="open" x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 transform -translate-y-2"
            x-transition:enter-end="opacity-100 transform translate-y-0"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 transform translate-y-0"
            x-transition:leave-end="opacity-0 transform -translate-y-2" class="px-6 pb-6 lg:hidden">

            <ul class="flex flex-col space-y-4 font-semibold text-gray-700">
                <li><a href="/" class="block transition hover:text-blue-600">Home</a></li>
                <li><a href="#about" class="block transition hover:text-blue-600">About</a></li>
                <li><a href="#why-us" class="block transition hover:text-blue-600">Why Us</a></li>
                <li><a href="#contact-us" class="block transition hover:text-blue-600">Contact Us</a></li>
            </ul>

            <!-- CTA Button -->
            <div class="mt-6">
                <a href="/contact"
                    class="relative inline-block w-full px-4 py-2 overflow-hidden font-semibold text-center text-white bg-pink-600 rounded-full group">
                    <span
                        class="absolute inset-0 w-full h-full transition-transform duration-300 ease-out origin-left transform scale-x-0 bg-blue-700 group-hover:scale-x-100"></span>
                    <span class="relative z-10 group-hover:text-white">Collaborate</span>
                </a>
            </div>
        </div>
    </nav>

    <div class="">
        <div class="relative w-full max-w-4xl mx-auto">
            <!-- Login Card -->

            <div class="flex flex-col items-center justify-center min-h-screen py-10">
                <!-- Logo -->
                <div class="flex items-center space-x-2 text-2xl font-bold text-black uppercase">
                    <img src="resources/images/moh.jpg" class="object-contain h-12" alt="Site Logo">
                    <img src="resources/images/log2.jpg" class="object-contain h-12" alt="Site Logo">
                </div>
                <p class="mt-1 text-sm opacity-70">
                    RMNCAH Coordination Hub
                </p>
                <div id="loginCard"
                    class="max-w-md p-8 mx-auto mt-4 space-y-4 transition-all duration-500 ease-in-out bg-white shadow-lg rounded-xl">
                    <h2 class="text-2xl font-semibold text-center text-gray-700">Welcome Back</h2>
                    <input id="loginEmail" type="email" required placeholder="Email"
                        class="w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500">
                    <div class="flex">
                        <button type="button" onclick="requestOtp()" id="loginBtn"
                            class="w-full py-2 text-center text-white transition bg-blue-600 rounded-md hover:bg-blue-700">
                            <span id="loginBtnText">Get OTP</span>
                            <span id="loginBtnSpinner" class="hidden">
                                <svg class="inline w-5 h-5 mr-2 text-white animate-spin"
                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                                Sending...
                            </span>
                        </button>
                    </div>
                    <div class="pt-4 text-center">
                        <button onclick="showRegister()" class="text-blue-600 hover:underline">Create a new
                            account
                        </button>
                    </div>
                </div>
            </div>

            <!-- Register Card -->
            <div id="registerCard"
                class="absolute top-0 left-0 z-10 hidden w-full max-w-4xl p-8 mx-auto mt-32 bg-white shadow-lg rounded-xl">
                <h2 class="mb-6 text-2xl font-semibold text-center text-gray-700">Create Account</h2>

                <form id="registerForm" onsubmit="return validateBeforeSubmit()"
                    class="grid grid-cols-1 gap-6 md:grid-cols-2">
                    <div>
                        <label class="block mb-1 text-sm font-medium">Full Name</label>
                        <input type="text" id="regName" placeholder="John Doe" class="w-full px-4 py-2 border rounded-md bg-gray-50">
                    </div>
                    <div>
                        <label class="block mb-1 text-sm font-medium">Email Address</label>
                        <input type="email" id="regEmail" placeholder="email@example.com"
                            class="w-full px-4 py-2 border rounded-md bg-gray-50">
                    </div>
                    <div>
                        <label class="block mb-1 text-sm font-medium">Organization</label>
                        <input type="text" id="regOrganization" placeholder="Company or School"
                            class="w-full px-4 py-2 border rounded-md bg-gray-50">
                    </div>
                    <div>
                        <label class="block mb-1 text-sm font-medium">Account Type</label>
                        <select id="regAccountType" class="w-full px-4 py-2 border rounded-md bg-gray-50">
                            <option value="PARTNER">Partner Organization</option>
                            <option value="DONOR">Donor Organization</option>
                        </select>
                    </div>
                    <div id="parentDonorSection" class="hidden md:col-span-2">
                        <label class="block mb-1 text-sm font-medium">Parent Donor ID (Optional)</label>
                        <input type="number" id="regParentDonorId" placeholder="Enter donor ID if linking to existing donor"
                            class="w-full px-4 py-2 border rounded-md bg-gray-50">
                        <p class="text-sm text-gray-600 mt-1">Leave empty if this is a standalone partner account</p>
                    </div>


                    <div class="grid grid-cols-2 gap-4 mt-6 space-x-4 md:col-span-2">
                        <button type="submit" id="registerBtn"
                            class="px-6 py-2 font-bold text-white bg-blue-600 rounded hover:bg-blue-700">
                            <span id="registerBtnText">Create Account</span>
                            <span id="registerBtnSpinner" class="hidden">
                                <svg class="inline w-5 h-5 mr-2 text-white animate-spin"
                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                                Creating...
                            </span>
                        </button>
                        <button type="button" onclick="hideRegister()"
                            class="px-6 py-2 text-blue-600 rounded bg-gray-50 hover:underline">Already have an
                            account?</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        async function requestOtp() {
            const email = document.getElementById("loginEmail").value;
            if (!email) return alert("Please enter your email");

            // Show loading state
            const btn = document.getElementById("loginBtn");
            const btnText = document.getElementById("loginBtnText");
            const btnSpinner = document.getElementById("loginBtnSpinner");

            btn.disabled = true;
            btn.classList.add("opacity-75", "cursor-not-allowed");
            btnText.classList.add("hidden");
            btnSpinner.classList.remove("hidden");

            // Request OTP from backend
            try {
                const apiBase = (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1")
                    ? "http://localhost:8080"
                    : "http://localhost:8080";
                const res = await fetch(`${apiBase}/api/auth/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email })
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.message || "Login failed");

                alert("OTP sent to your email. Please check your inbox.");
                localStorage.setItem("pendingEmail", email);
                localStorage.setItem("isLogin", "true");
                window.location.href = "otp.html";
            } catch (err) {
                alert(err.message || "Failed to send OTP");

                // Reset button state on error
                btn.disabled = false;
                btn.classList.remove("opacity-75", "cursor-not-allowed");
                btnText.classList.remove("hidden");
                btnSpinner.classList.add("hidden");
            }
        }
    </script>
    <script>
        async function validateBeforeSubmit() {
            const name = document.getElementById("regName").value;
            const email = document.getElementById("regEmail").value;
            const accountType = document.getElementById("regAccountType").value;
            const parentDonorId = document.getElementById("regParentDonorId").value;

            // Show loading state
            const btn = document.getElementById("registerBtn");
            const btnText = document.getElementById("registerBtnText");
            const btnSpinner = document.getElementById("registerBtnSpinner");

            btn.disabled = true;
            btn.classList.add("opacity-75", "cursor-not-allowed");
            btnText.classList.add("hidden");
            btnSpinner.classList.remove("hidden");

            try {
                const apiBase = (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1")
                    ? "http://localhost:8080"
                    : "http://localhost:8080";
                
                const payload = { name, email, accountType };
                if (accountType === "PARTNER" && parentDonorId) {
                    payload.parentDonorId = parseInt(parentDonorId);
                }
                
                const res = await fetch(`${apiBase}/api/auth/register`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.message || "Registration failed");

                alert("Registration successful! Check your email for the OTP.");
                localStorage.setItem("pendingEmail", email);
                window.location.href = "otp.html";
            } catch (err) {
                alert(err.message);

                // Reset button state on error
                btn.disabled = false;
                btn.classList.remove("opacity-75", "cursor-not-allowed");
                btnText.classList.remove("hidden");
                btnSpinner.classList.add("hidden");
            }

            return false;
        }

    </script>

    <script>
        function showRegister() {
            const login = document.getElementById("loginCard");
            const register = document.getElementById("registerCard");

            // Reset form fields
            document.getElementById("regName").value = "";
            document.getElementById("regEmail").value = "";
            document.getElementById("regOrganization").value = "";
            document.getElementById("regAccountType").value = "PARTNER";
            document.getElementById("regParentDonorId").value = "";
            toggleParentDonorSection();

            login.classList.add('fade-slide-leave');
            login.classList.add('fade-slide-leave-active');
            setTimeout(() => {
                login.style.display = "none";
                login.classList.remove('fade-slide-leave', 'fade-slide-leave-active');

                register.style.display = "block";
                register.classList.add('fade-slide-enter');
                requestAnimationFrame(() => {
                    register.classList.add('fade-slide-enter-active');
                });

                setTimeout(() => {
                    register.classList.remove('fade-slide-enter', 'fade-slide-enter-active');
                }, 400);
            }, 300);
        }

        function toggleParentDonorSection() {
            const accountType = document.getElementById("regAccountType").value;
            const parentDonorSection = document.getElementById("parentDonorSection");
            if (accountType === "PARTNER") {
                parentDonorSection.classList.remove("hidden");
            } else {
                parentDonorSection.classList.add("hidden");
            }
        }

        // Add event listener for account type changes
        document.addEventListener("DOMContentLoaded", function() {
            const accountTypeSelect = document.getElementById("regAccountType");
            if (accountTypeSelect) {
                accountTypeSelect.addEventListener("change", toggleParentDonorSection);
            }
        });

        function hideRegister() {
            const login = document.getElementById("loginCard");
            const register = document.getElementById("registerCard");

            register.classList.add('fade-slide-leave');
            register.classList.add('fade-slide-leave-active');
            setTimeout(() => {
                register.style.display = "none";
                register.classList.remove('fade-slide-leave', 'fade-slide-leave-active');

                login.style.display = "block";
                login.classList.add('fade-slide-enter');
                requestAnimationFrame(() => {
                    login.classList.add('fade-slide-enter-active');
                });

                setTimeout(() => {
                    login.classList.remove('fade-slide-enter', 'fade-slide-enter-active');
                }, 400);
            }, 300);
        }
    </script>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/tw-elements/js/tw-elements.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
    <!-- Leaflet JS -->


</body>

</html>