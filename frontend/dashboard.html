<!DOCTYPE html>
<html class="light" lang="en">

<head>
	<meta charset="utf-8" />
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<title>RMNCAH Dashboard</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;display=swap"
		rel="stylesheet" />
	<link
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
		rel="stylesheet" />
	<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
	<style>
		.material-symbols-outlined {
			font-variation-settings:
				'FILL' 0,
				'wght' 400,
				'GRAD' 0,
				'opsz' 24
		}
	</style>
	<script id="tailwind-config">
		tailwind.config = {
			darkMode: "class",
			theme: {
				extend: {
					colors: {
						"primary": "#137fec",
						"background-light": "#f6f7f8",
						"background-dark": "#101922",
						"neutral-text": "#4A4A4A"
					},
					fontFamily: {
						"display": ["Inter", "sans-serif"]
					},
					borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
				},
			},
		}
	</script>
	<script src="config.js"></script>
	<script src="auth.js"></script>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
		integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800;900&display=swap"
		rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
	<!-- Alpine.js -->
	<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
	<link rel="stylesheet" href="styles/main.css">
</head>

<body class="font-display bg-background-light dark:bg-background-dark text-neutral-text dark:text-gray-200">
	<div class="relative flex h-auto min-h-screen w-full group/design-root">




		<div class="md:flex md:min-h-screen">

			<!-- SIDEBAR -->
			<div x-data="{ open: false }" @click.away="open = false" class="w-full md:w-64 bg-white flex-shrink-0 
                sticky top-0 md:h-screen border-r">

				<!-- HEADER -->
				<div class="flex items-center justify-between px-6 py-4 border-b">
					<a href="#" class="text-lg font-bold text-purple-900 flex items-center uppercase tracking-wide">
						<img src="resources/images/log2.jpg" class=" mr-1 h-12" alt="">
						RMNCAH Dashboard
					</a>

					<!-- Mobile Menu Button -->
					<button class="md:hidden p-2 rounded-lg hover:bg-gray-100" @click="open = !open">
						<svg fill="currentColor" viewBox="0 0 20 20" class="w-6 h-6">
							<path x-show="!open" fill-rule="evenodd"
								d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z"
								clip-rule="evenodd"></path>

							<path x-show="open" fill-rule="evenodd"
								d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
								clip-rule="evenodd"></path>
						</svg>
					</button>
				</div>

				<!-- MENU -->
				<div class="px-4 py-4 md:py-4 md:block overflow-y-auto" :class="{ 'block': open, 'hidden': !open }">

					<div class="grid gap-2" id="sidebar-tabs">
						<!-- JS injects tabs here -->
					</div>

				</div>
			</div>

		</div>

		<div class="layout-container flex h-full grow flex-col w-full">

			<main class="flex-1 px-6 md:px-10 py-8">

				<div class="layout-content-container flex flex-col mx-auto w-full">
					<div class="layout-content-container flex flex-col mx-auto w-full" id="tab-content-container">
						<!-- Tab content will be injected by JS -->
					</div>

					<div id="tab-dashboard" class="tab-section" style="display:none;">

						<!-- Banner -->
						<div
							class="bg-white rounded-2xl border border-gray-200 shadow-md shadow-gray-100 overflow-hidden mb-10">
							<div class="p-10">
								<h3 class="text-3xl font-semibold text-purple-900 mb-3 tracking-tight">
									Welcome to RMNCAH Dashboard
								</h3>
								<p class="text-gray-600 text-base leading-relaxed max-w-2xl">
									Manage all RMNCAH projects, partners, and users in a unified, streamlined workspace.
								</p>
							</div>
						</div>

						<!-- Counters -->
						<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">

							<!-- Card -->
							<div
								class="bg-white rounded-2xl border border-gray-200 p-8 shadow-md shadow-gray-100 hover:shadow-xl hover:scale-[1.01] transition">
								<div class="flex items-center justify-between">
									<div>
										<p class="text-sm text-gray-500">Partners</p>
										<p id="partners-count" class="text-4xl font-semibold text-gray-900 mt-1">0</p>
									</div>
									<span class="material-symbols-outlined text-blue-600 text-5xl">group</span>
								</div>
							</div>

							<div
								class="bg-white rounded-2xl border border-gray-200 p-8 shadow-md shadow-gray-100 hover:shadow-xl hover:scale-[1.01] transition">
								<div class="flex items-center justify-between">
									<div>
										<p class="text-sm text-gray-500">Thematic Areas</p>
										<p id="thematic-areas-count" class="text-4xl font-semibold text-gray-900 mt-1">0
										</p>
									</div>
									<span class="material-symbols-outlined text-blue-600 text-5xl">category</span>
								</div>
							</div>

							<div
								class="bg-white rounded-2xl border border-gray-200 p-8 shadow-md shadow-gray-100 hover:shadow-xl hover:scale-[1.01] transition">
								<div class="flex items-center justify-between">
									<div>
										<p class="text-sm text-gray-500">Counties</p>
										<p id="counties-count" class="text-4xl font-semibold text-gray-900 mt-1">0</p>
									</div>
									<span class="material-symbols-outlined text-blue-600 text-5xl">location_on</span>
								</div>
							</div>

							<div
								class="bg-white rounded-2xl border border-gray-200 p-8 shadow-md shadow-gray-100 hover:shadow-xl hover:scale-[1.01] transition">
								<div class="flex items-center justify-between">
									<div>
										<p class="text-sm text-gray-500">Total Budget</p>
										<p id="budget-count" class="text-4xl font-semibold text-gray-900 mt-1">0</p>
									</div>
								</div>
							</div>

						</div>
						<div class="min-h-screen py-10">
							<div class="max-w-7xl mx-auto ">

								<div id="kpi-container"
									class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4 mb-10">
								</div>

								<div class="mb-10 flex justify-between items-center">
									<span class="text-sm text-gray-500">
										Last Updated: <span id="lastUpdated"></span>
									</span>
								</div>

								<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">

									<div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
										<h2 class="text-xl font-semibold mb-4 text-gray-900">
											Project Status by Theme</h2>
										<div id="barChart"></div>
									</div>

									<div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
										<h2 class="text-xl font-semibold mb-4 text-gray-900">
											Resource Distribution (%)</h2>
										<div id="teamChart"></div>
									</div>
								</div>

								<h2 class="text-2xl font-bold mb-6 text-gray-900 border-b pb-2">
									Performance by Thematic Area
								</h2>

								<div id="detail-card-container" class="grid grid-cols-1 gap-6 sm:grid-cols-2">
								</div>

							</div>
						</div>

					</div>

					<div id="tab-projects" class="tab-section" style="display:none;">

						<div
							class="bg-white rounded-2xl border border-gray-200 shadow-md shadow-gray-100 overflow-hidden mb-10">

							<!-- Header -->
							<div class="p-6 flex flex-wrap justify-between items-center gap-4 border-b border-gray-100">
								<h3 class="text-2xl font-semibold text-gray-900 tracking-tight">Projects</h3>

								<button
									class="flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 text-sm hover:bg-gray-200 hover:shadow transition">
									<span class="material-symbols-outlined text-base">file_download</span>
									Export CSV
								</button>
							</div>

							<!-- Table -->
							<div class="overflow-x-auto">
								<table class="w-full text-sm text-gray-700">

									<thead class="text-xs uppercase bg-gray-50 text-gray-600 border-y border-gray-200">
										<tr>
											<th class="px-6 py-3">Title</th>
											<th class="px-6 py-3">Partner Name</th>
											<th class="px-6 py-3">Project No</th>
											<th class="px-6 py-3">Category</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Start Date</th>
											<th class="px-6 py-3">End Date</th>
											<th class="px-6 py-3">Budget</th>
											<th class="px-6 py-3">Locations</th>
											<th class="px-6 py-3">Created At</th>
											<th class="px-6 py-3"></th>
										</tr>

										<!-- Filter Row (Pastel inputs) -->
										<tr class="bg-blue-50/50 border-t border-gray-200">
											<th class="px-6 py-2"><input type="text" data-column="0"
													placeholder="Filter Title"
													class="filter-input w-full px-3 py-2 text-xs border border-gray-300 rounded-lg bg-white focus:border-blue-400 focus:ring-blue-300 focus:ring">
											</th>
											<th class="px-6 py-2"><input type="text" data-column="1"
													placeholder="Filter Partner"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white focus:border-blue-400 focus:ring-blue-300 focus:ring">
											</th>
											<th class="px-6 py-2"><input type="text" data-column="2"
													placeholder="Filter Project No"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white focus:border-blue-400 focus:ring-blue-300 focus:ring">
											</th>
											<th class="px-6 py-2"><input type="text" data-column="3"
													placeholder="Filter Category"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white focus:border-blue-400">
											</th>
											<th class="px-6 py-2"><input type="text" data-column="4"
													placeholder="Filter Status"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white focus:border-blue-400">
											</th>
											<th class="px-6 py-2"><input type="text" data-column="5"
													placeholder="Filter Start"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input type="text" data-column="6"
													placeholder="Filter End"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input type="text" data-column="7"
													placeholder="Filter Budget"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input type="text" data-column="8"
													placeholder="Filter Locations"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input type="text" data-column="9"
													placeholder="Filter Created At"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th></th>
										</tr>
									</thead>

									<tbody></tbody>
								</table>
							</div>

							<!-- Pagination -->
							<nav aria-label="Table navigation" class="flex items-center justify-between p-5 bg-gray-50">
								<span class="text-sm text-gray-600">
									Showing <span class="font-semibold text-gray-900">1–1</span> of <span
										class="font-semibold text-gray-900">1</span>
								</span>

								<ul class="inline-flex -space-x-px text-sm">
									<li><a href="#"
											class="px-4 h-9 flex items-center justify-center border border-gray-300 bg-white rounded-l-lg hover:bg-gray-100 transition">Previous</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-100 transition">1</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 flex items-center justify-center border border-gray-300 bg-white rounded-r-lg hover:bg-gray-100 transition">Next</a>
									</li>
								</ul>
							</nav>
						</div>
					</div>

					<div id="tab-users" class="tab-section" style="display:none;">

						<div
							class="bg-white rounded-2xl border border-gray-200 shadow-md shadow-gray-100 overflow-hidden mb-10">

							<!-- Header -->
							<div class="p-6 flex flex-wrap justify-between items-center gap-4 border-b border-gray-100">
								<h3 class="text-2xl font-semibold text-gray-900 tracking-tight">Users</h3>

								<button
									class="flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 text-sm hover:bg-gray-200 hover:shadow transition">
									<span class="material-symbols-outlined text-base">file_download</span>
									Export CSV
								</button>
							</div>

							<!-- Table -->
							<div class="overflow-x-auto">
								<table class="w-full text-sm text-gray-700">
									<thead class="text-xs uppercase bg-gray-50 text-gray-600 border-y border-gray-200">

										<tr>
											<th class="px-6 py-3">Name</th>
											<th class="px-6 py-3">Email</th>
											<th class="px-6 py-3">Role</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Organization</th>
											<th class="px-6 py-3">Created At</th>
											<th class="px-6 py-3"></th>
										</tr>

										<tr class="bg-blue-50/50 border-t border-gray-200">
											<th class="px-6 py-2"><input data-column="0" placeholder="Filter Name"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="1" placeholder="Filter Email"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="2" placeholder="Filter Role"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="3" placeholder="Filter Status"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="4"
													placeholder="Filter Organization"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="5" placeholder="Filter Created At"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th></th>
										</tr>

									</thead>

									<tbody></tbody>
								</table>
							</div>

							<!-- Pagination -->
							<nav class="flex items-center justify-between p-5 bg-gray-50">
								<span class="text-sm text-gray-600">Showing <span
										class="font-semibold text-gray-900">1–1</span> of <span
										class="font-semibold text-gray-900">1</span></span>

								<ul class="inline-flex -space-x-px text-sm">
									<li><a href="#"
											class="px-4 h-9 flex items-center justify-center border border-gray-300 bg-white rounded-l-lg hover:bg-gray-100">Previous</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-100">1</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 flex items-center justify-center border border-gray-300 bg-white rounded-r-lg hover:bg-gray-100">Next</a>
									</li>
								</ul>
							</nav>

						</div>
					</div>

					<div id="tab-organizations" class="tab-section" style="display:none;">

						<div
							class="bg-white rounded-2xl border border-gray-200 shadow-md shadow-gray-100 overflow-hidden mb-10">

							<!-- Header -->
							<div class="p-6 flex flex-wrap justify-between items-center gap-4 border-b border-gray-100">
								<h3 class="text-2xl font-semibold text-gray-900 tracking-tight">Organizations</h3>

								<button
									class="flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 shadow-sm transition">
									<span class="material-symbols-outlined text-base">file_download</span>
									Export CSV
								</button>
							</div>

							<!-- Table -->
							<div class="overflow-x-auto">
								<table class="w-full text-sm text-gray-700">

									<thead class="text-xs uppercase bg-gray-50 text-gray-600 border-y border-gray-200">
										<tr>
											<th class="px-6 py-3">Name</th>
											<th class="px-6 py-3">Type</th>
											<th class="px-6 py-3">Email</th>
											<th class="px-6 py-3">Location</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Created At</th>
											<th class="px-6 py-3"></th>
										</tr>

										<!-- Filter Row -->
										<tr class="bg-blue-50/50 border-t border-gray-200">
											<th class="px-6 py-2"><input data-column="0" placeholder="Filter Name"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="1" placeholder="Filter Type"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="2" placeholder="Filter Email"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="3" placeholder="Filter Location"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="4" placeholder="Filter Status"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="5" placeholder="Filter Created At"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th></th>
										</tr>
									</thead>

									<tbody></tbody>
								</table>
							</div>

							<!-- Pagination -->
							<nav class="flex items-center justify-between p-5 bg-gray-50">
								<span class="text-sm text-gray-600">
									Showing <span class="font-semibold text-gray-900">1-1</span> of
									<span class="font-semibold text-gray-900">1</span>
								</span>

								<ul class="inline-flex -space-x-px text-sm">
									<li><a href="#"
											class="px-4 h-9 flex items-center justify-center border border-gray-300 bg-white rounded-l-lg hover:bg-gray-100">Previous</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 flex items-center justify-center border border-gray-300 bg-white hover:bg-gray-100">1</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 flex items-center justify-center border border-gray-300 bg-white rounded-r-lg hover:bg-gray-100">Next</a>
									</li>
								</ul>
							</nav>
						</div>
					</div>


					<div id="tab-announcements" class="tab-section" style="display:none;">

						<div
							class="bg-white rounded-2xl border border-gray-200 shadow-md shadow-gray-100 overflow-hidden mb-10">

							<!-- Header -->
							<div class="p-6 flex flex-wrap justify-between items-center gap-4 border-b border-gray-100">
								<h3 class="text-2xl font-semibold text-gray-900 tracking-tight">Announcements</h3>

								<div class="flex items-center gap-2">
									<button id="create-announcement-btn"
										class="flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg bg-blue-600 text-white hover:bg-blue-700 shadow-sm transition">
										<span class="material-symbols-outlined text-base">add</span>
										Create Announcement
									</button>

									<button
										class="flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 shadow-sm transition">
										<span class="material-symbols-outlined text-base">file_download</span>
										Export CSV
									</button>
								</div>
							</div>

							<!-- Table -->
							<div class="overflow-x-auto">
								<table class="w-full text-sm text-gray-700">

									<thead class="text-xs uppercase bg-gray-50 text-gray-600 border-y border-gray-200">
										<tr>
											<th class="px-6 py-3">Title</th>
											<th class="px-6 py-3">Content</th>
											<th class="px-6 py-3">Date</th>
											<th class="px-6 py-3">Created By</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Priority</th>
											<th class="px-6 py-3">Created At</th>
											<th class="px-6 py-3"></th>
										</tr>

										<!-- Filters -->
										<tr class="bg-blue-50/50 border-t border-gray-200">
											<th class="px-6 py-2"><input data-column="0" placeholder="Filter Title"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="1" placeholder="Filter Content"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="2" placeholder="Filter Date"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="3" placeholder="Filter Created By"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="4" placeholder="Filter Status"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="5" placeholder="Filter Priority"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="6" placeholder="Filter Created At"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th></th>
										</tr>
									</thead>

									<tbody></tbody>
								</table>
							</div>

							<!-- Pagination -->
							<nav class="flex items-center justify-between p-5 bg-gray-50">
								<span class="text-sm text-gray-600">Showing <span class="font-semibold">1-1</span> of
									<span class="font-semibold">1</span></span>

								<ul class="inline-flex -space-x-px text-sm">
									<li><a href="#"
											class="px-4 h-9 border border-gray-300 bg-white rounded-l-lg hover:bg-gray-100 flex items-center">Previous</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 border border-gray-300 bg-white hover:bg-gray-100 flex items-center">1</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 border border-gray-300 bg-white rounded-r-lg hover:bg-gray-100 flex items-center">Next</a>
									</li>
								</ul>
							</nav>
						</div>

						<!-- Create Modal -->
						<div id="create-announcement-modal" class="fixed inset-0 bg-black/40 hidden z-50">
							<div class="flex items-center justify-center min-h-screen p-4">
								<div class="bg-white rounded-xl shadow-lg max-w-md w-full p-6">

									<h3 class="text-xl font-semibold text-gray-900 mb-4">Create Announcement</h3>

									<form id="create-announcement-form">

										<div class="mb-4">
											<label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
											<input id="announcement-title" required
												class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-white">
										</div>

										<div class="mb-4">
											<label class="block text-sm font-medium text-gray-700 mb-2">Content</label>
											<textarea id="announcement-content" rows="4"
												class="w-full px-3 py-2 border rounded-lg" required></textarea>
										</div>

										<div class="mb-4">
											<label class="block text-sm font-medium text-gray-700 mb-2">Deadline
												(optional)</label>
											<input type="date" id="announcement-deadline"
												class="w-full px-3 py-2 border rounded-lg bg-white">
										</div>

										<div class="mb-4">
											<label class="block text-sm font-medium text-gray-700 mb-2">Collaboration
												Type</label>
											<select id="announcement-collaboration-type"
												class="w-full px-3 py-2 border rounded-lg bg-white">
												<option value="OPEN">Open</option>
												<option value="INVITATION_ONLY">Invitation Only</option>
											</select>
										</div>

										<div class="flex justify-end gap-3">
											<button type="button" id="cancel-announcement-btn"
												class="px-4 py-2 text-sm rounded-lg text-gray-700 hover:bg-gray-100">
												Cancel
											</button>
											<button type="submit"
												class="px-4 py-2 text-sm rounded-lg bg-blue-600 hover:bg-blue-700 text-white">
												Create
											</button>
										</div>

									</form>
								</div>
							</div>
						</div>
					</div>


					<div id="tab-collaboration" class="tab-section" style="display:none;">

						<div
							class="bg-white rounded-2xl border border-gray-200 shadow-md shadow-gray-100 overflow-hidden mb-10">

							<!-- Header -->
							<div class="p-6 flex flex-wrap justify-between items-center gap-4 border-b border-gray-100">
								<h3 class="text-2xl font-semibold text-gray-900 tracking-tight">Collaboration Requests
								</h3>

								<button
									class="flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 shadow-sm transition">
									<span class="material-symbols-outlined">file_download</span>
									Export CSV
								</button>
							</div>

							<!-- Table -->
							<div class="overflow-x-auto">
								<table class="w-full text-sm text-gray-700">

									<thead class="text-xs uppercase bg-gray-50 text-gray-600 border-y border-gray-200">
										<tr>
											<th class="px-6 py-3">Requester</th>
											<th class="px-6 py-3">Project</th>
											<th class="px-6 py-3">Organization</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Message</th>
											<th class="px-6 py-3">Date</th>
											<th class="px-6 py-3"></th>
										</tr>

										<!-- Filters -->
										<tr class="bg-blue-50/50 border-t border-gray-200">
											<th class="px-6 py-2"><input data-column="0" placeholder="Filter Requester"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="1" placeholder="Filter Project"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="2"
													placeholder="Filter Organization"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="3" placeholder="Filter Status"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="4" placeholder="Filter Message"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th class="px-6 py-2"><input data-column="5" placeholder="Filter Date"
													class="filter-input w-full px-3 py-2 text-xs border rounded-lg bg-white">
											</th>
											<th></th>
										</tr>
									</thead>

									<tbody></tbody>
								</table>
							</div>

							<!-- Pagination -->
							<nav class="flex items-center justify-between p-5 bg-gray-50">
								<span class="text-sm text-gray-600">Showing <span class="font-semibold">1-1</span> of
									<span class="font-semibold">1</span></span>

								<ul class="inline-flex -space-x-px text-sm">
									<li><a href="#"
											class="px-4 h-9 border border-gray-300 bg-white rounded-l-lg hover:bg-gray-100 flex items-center">Previous</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 border border-gray-300 bg-white hover:bg-gray-100 flex items-center">1</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 border border-gray-300 bg-white rounded-r-lg hover:bg-gray-100 flex items-center">Next</a>
									</li>
								</ul>
							</nav>

						</div>
					</div>


					<div id="tab-pastprojects" class="tab-section" style="display:none;">

						<div
							class="bg-white rounded-2xl border border-gray-200 shadow-md shadow-gray-100 overflow-hidden mb-10">

							<!-- Header -->
							<div class="p-6 flex flex-wrap justify-between items-center gap-4 border-b border-gray-100">
								<h3 class="text-2xl font-semibold text-gray-900 tracking-tight">Past Projects</h3>

								<button
									class="flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 shadow-sm transition">
									<span class="material-symbols-outlined text-base">file_download</span>
									Export CSV
								</button>
							</div>

							<!-- Table -->
							<div class="overflow-x-auto">
								<table class="w-full text-sm text-gray-700">

									<thead class="text-xs uppercase bg-gray-50 text-gray-600 border-y border-gray-200">
										<tr>
											<th class="px-6 py-3">Name</th>
											<th class="px-6 py-3">Description</th>
											<th class="px-6 py-3">Organization</th>
											<th class="px-6 py-3">Category</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Budget</th>
											<th class="px-6 py-3">Completion Date</th>
											<th class="px-6 py-3">Created At</th>
											<th class="px-6 py-3"></th>
										</tr>

										<!-- Filters -->
										<tr class="bg-blue-50/50 border-t border-gray-200">
											<th class="px-6 py-2"><input data-column="0" placeholder="Filter Name"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="1"
													placeholder="Filter Description"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="2"
													placeholder="Filter Organization"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="3" placeholder="Filter Category"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="4" placeholder="Filter Status"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="5" placeholder="Filter Budget"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="6"
													placeholder="Filter Completion Date"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th class="px-6 py-2"><input data-column="7" placeholder="Filter Created At"
													class="w-full px-3 py-2 text-xs border rounded-lg bg-white"></th>
											<th></th>
										</tr>
									</thead>

									<tbody></tbody>
								</table>
							</div>

							<!-- Pagination -->
							<nav class="flex items-center justify-between p-5 bg-gray-50">
								<span class="text-sm text-gray-600">Showing <span class="font-semibold">1-1</span> of
									<span class="font-semibold">1</span></span>

								<ul class="inline-flex -space-x-px text-sm">
									<li><a href="#"
											class="px-4 h-9 border border-gray-300 bg-white rounded-l-lg hover:bg-gray-100 flex items-center">Previous</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 border border-gray-300 bg-white hover:bg-gray-100 flex items-center">1</a>
									</li>
									<li><a href="#"
											class="px-4 h-9 border border-gray-300 bg-white rounded-r-lg hover:bg-gray-100 flex items-center">Next</a>
									</li>
								</ul>
							</nav>

						</div>
					</div>


					<div id="tab-projectdocs" class="tab-section" style="display:none;">
						<div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-8">
							<div class="p-4 flex flex-wrap justify-between items-center gap-4">
								<h3 class="text-lg font-bold text-neutral-text">Project Documents</h3>
								<button
									class="flex h-9 items-center gap-x-2 rounded-lg bg-gray-100 pl-3 pr-2 text-sm font-medium text-neutral-text hover:bg-gray-200">
									<span class="material-symbols-outlined text-base">file_download</span>
									<span>Export CSV</span>
								</button>
							</div>

							<div class="overflow-x-auto">
								<table class="w-full text-sm text-left text-gray-600">
									<thead class="text-xs text-gray-700 uppercase bg-gray-50">
										<tr>
											<th class="px-6 py-3">File Name</th>
											<th class="px-6 py-3">Project</th>
											<th class="px-6 py-3">Uploaded By</th>
											<th class="px-6 py-3">Type</th>
											<th class="px-6 py-3">Size</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Date</th>
											<th class="px-6 py-3">Created At</th>
											<th class="px-6 py-3"><span class="sr-only">Actions</span></th>
										</tr>

										<!-- Filters -->
										<tr class="filter-row bg-gray-100">
											<th class="px-6 py-2"><input type="text" placeholder="Filter File Name"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="0"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Project"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="1"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Uploaded By"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="2"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Type"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="3"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Size"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="4"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Status"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="5"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Date"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="6"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Created At"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="7"></th>
											<th></th>
										</tr>
									</thead>

									<tbody></tbody>
								</table>
							</div>

							<!-- Pagination -->
							<nav class="flex items-center justify-between p-4">
								<span class="text-sm text-gray-500">Showing <span
										class="font-semibold text-gray-900">1-1</span> of <span
										class="font-semibold text-gray-900">1</span></span>
								<ul class="inline-flex -space-x-px text-sm h-8">
									<li><a class="flex items-center justify-center px-3 h-8 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100"
											href="#">Previous</a></li>
									<li><a class="flex items-center justify-center px-3 h-8 bg-white border border-gray-300 hover:bg-gray-100"
											href="#">1</a></li>
									<li><a class="flex items-center justify-center px-3 h-8 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100"
											href="#">Next</a></li>
								</ul>
							</nav>
						</div>
					</div>


					<div id="tab-projectreports" class="tab-section" style="display:none;">
						<div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-8">
							<div class="p-4 flex flex-wrap justify-between items-center gap-4">
								<h3 class="text-lg font-bold text-neutral-text">Project Reports</h3>
								<button
									class="flex h-9 items-center gap-x-2 rounded-lg bg-gray-100 pl-3 pr-2 text-sm font-medium text-neutral-text hover:bg-gray-200">
									<span class="material-symbols-outlined text-base">file_download</span>
									<span>Export CSV</span>
								</button>
							</div>

							<div class="overflow-x-auto">
								<table class="w-full text-sm text-left text-gray-600">
									<thead class="text-xs text-gray-700 uppercase bg-gray-50">
										<tr>
											<th class="px-6 py-3">Report Title</th>
											<th class="px-6 py-3">Project</th>
											<th class="px-6 py-3">Created By</th>
											<th class="px-6 py-3">Type</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Date</th>
											<th class="px-6 py-3">Created At</th>
											<th class="px-6 py-3"><span class="sr-only">Actions</span></th>
										</tr>

										<tr class="filter-row bg-gray-100">
											<th class="px-6 py-2"><input type="text" placeholder="Filter Report Title"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="0"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Project"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="1"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Created By"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="2"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Type"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="3"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Status"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="4"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Date"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="5"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Created At"
													class="filter-input w-full px-2 py-1 text-xs border rounded"
													data-column="6"></th>
											<th></th>
										</tr>
									</thead>

									<tbody></tbody>
								</table>
							</div>

							<nav class="flex items-center justify-between p-4">
								<span class="text-sm text-gray-500">Showing <span
										class="font-semibold text-gray-900">1-1</span> of <span
										class="font-semibold text-gray-900">1</span></span>
								<ul class="inline-flex -space-x-px text-sm h-8">
									<li><a class="px-3 h-8 flex items-center justify-center bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100"
											href="#">Previous</a></li>
									<li><a class="px-3 h-8 flex items-center justify-center bg-white border border-gray-300 hover:bg-gray-100"
											href="#">1</a></li>
									<li><a class="px-3 h-8 flex items-center justify-center bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100"
											href="#">Next</a></li>
								</ul>
							</nav>
						</div>
					</div>


					<div id="tab-userdocs" class="tab-section" style="display:none;">
						<div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-8">
							<div class="p-4 flex flex-wrap justify-between items-center gap-4">
								<h3 class="text-lg font-bold text-neutral-text">User Documents</h3>
								<button
									class="flex h-9 items-center gap-x-2 rounded-lg bg-gray-100 pl-3 pr-2 text-sm font-medium text-neutral-text hover:bg-gray-200">
									<span class="material-symbols-outlined text-base">file_download</span>
									<span>Export CSV</span>
								</button>
							</div>

							<div class="overflow-x-auto">
								<table class="w-full text-sm text-left text-gray-600">
									<thead class="text-xs text-gray-700 uppercase bg-gray-50">
										<tr>
											<th class="px-6 py-3">File Name</th>
											<th class="px-6 py-3">User</th>
											<th class="px-6 py-3">Uploaded By</th>
											<th class="px-6 py-3">Type</th>
											<th class="px-6 py-3">Size</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Date</th>
											<th class="px-6 py-3">Created At</th>
											<th class="px-6 py-3"><span class="sr-only">Actions</span></th>
										</tr>

										<tr class="filter-row bg-gray-100">
											<th class="px-6 py-2"><input type="text" placeholder="Filter File Name"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter User"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Uploaded By"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Type"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Size"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Status"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Date"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Created At"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th></th>
										</tr>
									</thead>
									<tbody></tbody>
								</table>
							</div>

							<nav class="flex items-center justify-between p-4">
								<span class="text-sm text-gray-500">Showing <span
										class="font-semibold text-gray-900">1-1</span> of <span
										class="font-semibold text-gray-900">1</span></span>
								<ul class="inline-flex -space-x-px text-sm h-8">
									<li><a class="px-3 h-8 flex items-center justify-center bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100"
											href="#">Previous</a></li>
									<li><a class="px-3 h-8 flex items-center justify-center bg-white border border-gray-300 hover:bg-gray-100"
											href="#">1</a></li>
									<li><a class="px-3 h-8 flex items-center justify-center bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100"
											href="#">Next</a></li>
								</ul>
							</nav>
						</div>
					</div>


					<div id="tab-userdocs" class="tab-section" style="display:none;">
						<div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-8">
							<div class="p-4 flex flex-wrap justify-between items-center gap-4">
								<h3 class="text-lg font-bold text-neutral-text">User Documents</h3>
								<button
									class="flex h-9 items-center gap-x-2 rounded-lg bg-gray-100 pl-3 pr-2 text-sm font-medium text-neutral-text hover:bg-gray-200">
									<span class="material-symbols-outlined text-base">file_download</span>
									<span>Export CSV</span>
								</button>
							</div>

							<div class="overflow-x-auto">
								<table class="w-full text-sm text-left text-gray-600">
									<thead class="text-xs text-gray-700 uppercase bg-gray-50">
										<tr>
											<th class="px-6 py-3">File Name</th>
											<th class="px-6 py-3">User</th>
											<th class="px-6 py-3">Uploaded By</th>
											<th class="px-6 py-3">Type</th>
											<th class="px-6 py-3">Size</th>
											<th class="px-6 py-3">Status</th>
											<th class="px-6 py-3">Date</th>
											<th class="px-6 py-3">Created At</th>
											<th class="px-6 py-3"><span class="sr-only">Actions</span></th>
										</tr>

										<tr class="filter-row bg-gray-100">
											<th class="px-6 py-2"><input type="text" placeholder="Filter File Name"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter User"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Uploaded By"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Type"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Size"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Status"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Date"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th class="px-6 py-2"><input type="text" placeholder="Filter Created At"
													class="w-full px-2 py-1 text-xs border rounded"></th>
											<th></th>
										</tr>
									</thead>
									<tbody></tbody>
								</table>
							</div>

							<nav class="flex items-center justify-between p-4">
								<span class="text-sm text-gray-500">Showing <span
										class="font-semibold text-gray-900">1-1</span> of <span
										class="font-semibold text-gray-900">1</span></span>
								<ul class="inline-flex -space-x-px text-sm h-8">
									<li><a class="px-3 h-8 flex items-center justify-center bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100"
											href="#">Previous</a></li>
									<li><a class="px-3 h-8 flex items-center justify-center bg-white border border-gray-300 hover:bg-gray-100"
											href="#">1</a></li>
									<li><a class="px-3 h-8 flex items-center justify-center bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100"
											href="#">Next</a></li>
								</ul>
							</nav>
						</div>
					</div>

				</div>
			</main>
		</div>
	</div>
	<script>
		// --- 1. Utility Functions ---
		const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
		const formatNumber = (num) => num.toLocaleString();
		const formatCurrency = (num) => '$' + num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

		// --- 2. Analytic Metric Generator for Detail Cards ---
		function generateCategoryAnalytics() {
			const totalProjects = rand(40, 150);
			const active = rand(Math.floor(totalProjects * 0.3), Math.floor(totalProjects * 0.7));
			const pending = rand(Math.floor(totalProjects * 0.1), Math.floor(totalProjects * 0.3));
			const stalled = rand(Math.floor(totalProjects * 0.05), Math.floor(totalProjects * 0.2));
			const completed = Math.max(0, totalProjects - active - pending - stalled); // Ensure non-negative

			return {
				totalCost: rand(5, 50), // Millions
				totalProjects: totalProjects,
				active: active,
				pending: pending,
				stalled: stalled,
				completed: completed,
				avgDurationMonths: rand(12, 48),
				expectedCompletion: `Q${rand(1, 4)} ${new Date().getFullYear() + rand(0, 2)}`
			};
		}

		// --- 3. Program Data Structure ---
		const categories = [
			{ code: 'GBV', name: 'Gender-Based Violence', icon: 'fas fa-hand-rock', color: 'red' },
			{ code: 'AYPSRH', name: 'Adolescent & Youth SRH', icon: 'fas fa-baby', color: 'blue' },
			{ code: 'MWH', name: 'Maternal & Women\'s Health', icon: 'fas fa-heartbeat', color: 'pink' },
			{ code: 'FP', name: 'Family Planning', icon: 'fas fa-users', color: 'indigo' },
			{ code: 'CH', name: 'Child Health', icon: 'fas fa-child', color: 'green' },
			{ code: 'A', name: 'AIDS/HIV', icon: 'fas fa-ribbon', color: 'gray' },
			{ code: 'AS', name: 'Adolescent Sexuality', icon: 'fas fa-venus-mars', color: 'purple' },
			{ code: 'MONITORING_EVALUATION', name: 'Monitoring & Evaluation', icon: 'fas fa-chart-line', color: 'teal' },
			{ code: 'RESEARCH_LEARNING', name: 'Research & Learning', icon: 'fas fa-search', color: 'cyan' },
		];

		// --- 4. KPI Definitions ---
		const kpis = [
			{ title: "Total Projects", value: rand(100, 500), unit: "", color: "indigo", change: rand(5, 15), isPositive: true },
			{ title: "Investment (USD)", value: rand(10, 50), unit: "M", color: "green", change: rand(1, 5), isPositive: false, formatter: (val) => formatCurrency(val) },
			{ title: "Beneficiaries Reached", value: rand(50000, 200000), unit: "", color: "yellow", change: rand(15, 30), isPositive: true, formatter: (val) => formatNumber(val) },
			{ title: "Average Completion Rate", value: rand(60, 95), unit: "%", color: "red", change: 0, isPositive: false, formatter: (val) => val },
		];


		// --- 5. Main Rendering Logic ---
		function renderDashboard() {
			document.getElementById('lastUpdated').textContent = new Date().toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: 'numeric', minute: 'numeric' });

			// A. Render KPI Cards
			const kpiHTML = kpis.map(kpi => {
				const changeColor = kpi.isPositive ? 'text-green-500' : 'text-red-500';
				const changeIcon = kpi.isPositive ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
				const formattedValue = (kpi.formatter || formatNumber)(kpi.value);

				return `
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-${kpi.color}-500">
                        <p class="text-sm font-medium text-gray-500">${kpi.title}</p>
                        <p class="mt-1 text-3xl font-semibold text-gray-900">
                            ${formattedValue}${kpi.unit}
                        </p>
                        <div class="text-sm ${changeColor} mt-2">
                            ${kpi.change > 0 ? `<i class="${changeIcon}"></i> ${kpi.change}% Change` : `<i class="fas fa-equals"></i> Steady Performance`}
                        </div>
                    </div>
                `;
			}).join('');
			document.getElementById('kpi-container').innerHTML = kpiHTML;


			// B. Render Detail Cards
			const detailCardHTML = categories.map(cat => {
				const data = generateCategoryAnalytics();

				const completedPercent = ((data.completed / data.totalProjects) * 100).toFixed(0);

				return `
                    <div class="bg-white p-6 rounded-xl shadow-md transition duration-300 hover:shadow-xl border-t-4 border-${cat.color}-500">
                        <div class="flex items-start justify-between">
                            <div>
                                <span class="text-xs font-medium text-gray-500">${cat.name}</span>
                                <h3 class="text-xl font-bold text-gray-900">
                                    <i class="${cat.icon} mr-2 text-${cat.color}-600"></i> ${cat.code}
                                </h3>
                            </div>
                            <div class="text-right">
                                <span class="text-sm text-gray-400">Total Cost</span>
                                <p class="text-2xl font-extrabold text-green-600">
                                    ${formatCurrency(data.totalCost)}M
                                </p>
                            </div>
                        </div>
                        
                        <hr class="my-4">

                        <div class="mb-4">
                            <p class="text-sm font-semibold text-gray-700 mb-2">
                                Status Breakdown (${data.totalProjects} Projects Total)
                            </p>
                            <div class="flex h-3 rounded overflow-hidden">
                                <div style="width: ${((data.active / data.totalProjects) * 100).toFixed(0)}%" 
                                     class="bg-blue-500" title="${data.active} Active"></div>
                                <div style="width: ${((data.pending / data.totalProjects) * 100).toFixed(0)}%" 
                                     class="bg-yellow-500" title="${data.pending} Pending"></div>
                                <div style="width: ${((data.stalled / data.totalProjects) * 100).toFixed(0)}%" 
                                     class="bg-red-500" title="${data.stalled} Stalled"></div>
                                <div style="width: ${((data.completed / data.totalProjects) * 100).toFixed(0)}%" 
                                     class="bg-green-500" title="${data.completed} Completed"></div>
                            </div>
                        </div>

                        <div class="space-y-3 text-sm text-gray-700">
                             <p class="flex justify-between items-center">
                                <span class="font-medium flex items-center"><i class="fas fa-check-double mr-2 text-green-500"></i> Completed Rate:</span> 
                                <span class="font-bold text-lg text-green-500">${completedPercent}%</span>
                            </p>
                            <p class="flex justify-between items-center">
                                <span class="font-medium flex items-center"><i class="fas fa-clock mr-2 text-gray-500"></i> Avg Duration:</span> 
                                <span class="font-bold">${data.avgDurationMonths} months</span>
                            </p>
                            <p class="flex justify-between items-center">
                                <span class="font-medium flex items-center"><i class="fas fa-calendar-alt mr-2 text-indigo-500"></i> Next Milestone:</span> 
                                <span class="font-bold">${data.expectedCompletion}</span>
                            </p>
                        </div>
                    </div>
                `;
			}).join('');
			document.getElementById('detail-card-container').innerHTML = detailCardHTML;
		}


		// --- 6. ApexCharts Initialization ---

		// Bar Chart Data (Project Status by Area)
		var barCategories = ["GBV", "AYPSRH", "MWH", "FP", "CH", "A", "AS", "MONITORING_EVALUATION", "RESEARCH_LEARNING"];
		var activeData = [15, 20, 18, 12, 5, 25, 9, 7, 6];
		var pendingData = [8, 10, 7, 5, 3, 15, 4, 3, 2];
		var stalledData = [3, 4, 2, 1, 1, 5, 2, 1, 1];
		var completedData = [30, 45, 35, 25, 10, 50, 20, 15, 10];

		var barOptions = {
			chart: {
				type: "bar", height: 400, stacked: false, id: 'projectStatusChart'
			},
			plotOptions: { bar: { horizontal: false, columnWidth: "70%" } },
			dataLabels: { enabled: false },
			series: [
				{ name: "Active", data: activeData },
				{ name: "Pending", data: pendingData },
				{ name: "Stalled", data: stalledData },
				{ name: "Completed", data: completedData },
			],
			xaxis: {
				categories: barCategories,
				title: { text: "Programmatic Area" },
				labels: { rotate: -45 }
			},
			yaxis: { title: { text: "Number of Projects/Interventions" } },
			legend: { position: "top" },
			colors: ['#3B82F6', '#F59E0B', '#EF4444', '#10B981'], // blue, yellow, red, green
			tooltip: { y: { formatter: function (val) { return val.toFixed(0) + " Projects"; } } }
		};

		// Donut Chart Data (Resource Distribution)
		var donutSeriesData = [8, 14, 27, 21, 3, 2, 17, 8, 5];
		var donutLabels = ["GBV", "AYPSRH", "MWH", "FP", "CH", "A", "AS", "MONITORING_EVALUATION", "RESEARCH_LEARNING"];
		var donutColors = ["#EF4444", "#3B82F6", "#EC4899", "#6366F1", "#10B981", "#6B7280", "#9333ea", "#14B8A6", "#06B6D4"];

		var donutOptions = {
			chart: { type: "donut", height: 350 },
			series: donutSeriesData,
			labels: donutLabels,
			colors: donutColors,
			legend: { position: "bottom" },
			dataLabels: { enabled: true, formatter: function (val) { return val.toFixed(0) + "%"; } },
			tooltip: { y: { formatter: function (val, opts) { return opts.w.config.series[opts.seriesIndex] + "% of Focus"; } } },
		};

		// --- 7. Initialization on Load ---
		document.addEventListener('DOMContentLoaded', () => {
			renderDashboard();

			// Render Charts after the DOM is ready
			var barChart = new ApexCharts(document.querySelector("#barChart"), barOptions);
			barChart.render();

			var donutChart = new ApexCharts(document.querySelector("#teamChart"), donutOptions);
			donutChart.render();
		});

	</script>
	<script>
		async function apiFetch(endpoint, options = {}) {
			const token = window.authManager.getToken();
			if (!token) {
				alert('Not authenticated. Please log in.');
				window.location.href = 'index.html';
				return;
			}
			return fetch(`${window.BASE_URL}${endpoint}`, {
				...options,
				headers: {
					'Authorization': `Bearer ${token}`,
					'Content-Type': 'application/json',
					...options.headers,
				},
			});
		}

		function renderTable(tabId, data, columns) {
			const tbody = document.querySelector(`#${tabId} tbody`);
			if (!tbody) return;
			tbody.innerHTML = '';
			if (!Array.isArray(data)) {
				console.error('Data is not an array for', tabId, ':', data);
				return;
			}
			data.forEach(item => {
				const row = document.createElement('tr');
				row.className = 'bg-white dark:bg-gray-900/50 border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50';
				columns.forEach(col => {
					const td = document.createElement('td');
					td.className = 'px-6 py-4';
					let value = getNestedValue(item, col) || '';
					// Format dates
					if ((col.includes('Date') || col.includes('At')) && value) {
						const date = new Date(value);
						if (!isNaN(date)) {
							value = date.toLocaleDateString('en-GB') + ', ' + date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
						}
					}
					// Format file sizes
					if (col === 'size' && value) {
						value = formatFileSize(value);
					}
					// Format locations
					if (col === 'locations' && Array.isArray(value)) {
						value = value.map(loc => loc.county).join(', ');
					}
					td.textContent = value;
					row.appendChild(td);
				});
				const actionTd = document.createElement('td');
				actionTd.className = 'px-6 py-4 text-right';
				actionTd.innerHTML = '';
				row.appendChild(actionTd);
				tbody.appendChild(row);
			});
		}

		function getNestedValue(obj, path) {
			return path.split('.').reduce((current, key) => current && current[key], obj);
		}

		function formatFileSize(bytes) {
			if (!bytes || bytes === 0) return '0 B';
			const k = 1024;
			const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
			const i = Math.floor(Math.log(bytes) / Math.log(k));
			return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
		}

		async function fetchProjects() {
			try {
				const response = await apiFetch('/api/projects');
				if (!response.ok) throw new Error('Failed to fetch projects');
				const data = await response.json();
				const projects = data.data?.projects || data.data?.content || data.data || data;
				if (!Array.isArray(projects)) {
					console.error('Projects data not array:', projects);
					return;
				}
				renderTable('tab-projects', projects, ['title', 'partnerName', 'projectNo', 'projectCategory', 'status', 'startDate', 'endDate', 'budget', 'locations', 'createdAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-projects .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-projects tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-projects button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('projects.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['Title', 'Partner Name', 'Project No', 'Category', 'Status', 'Start Date', 'End Date', 'Budget', 'Locations', 'Created At'];
					const rows = document.querySelectorAll('#tab-projects tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching projects:', error);
			}
		}

		async function fetchUsers() {
			try {
				const response = await apiFetch('/api/auth/admin/users');
				if (!response.ok) throw new Error('Failed to fetch users');
				const data = await response.json();
				const users = data.data?.users || data.data?.content || data.data || data;
				if (!Array.isArray(users)) {
					console.error('Users data not array:', users);
					return;
				}
				renderTable('tab-users', users, ['name', 'email', 'role', 'status', 'organization.name', 'createdAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-users .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-users tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-users button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('users.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['Name', 'Email', 'Role', 'Status', 'Organization', 'Created At'];
					const rows = document.querySelectorAll('#tab-users tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching users:', error);
			}
		}

		async function fetchOrganizations() {
			try {
				const response = await apiFetch('/api/organizations');
				if (!response.ok) throw new Error('Failed to fetch organizations');
				const data = await response.json();
				const orgs = data.data?.organizations || data.data?.content || data.data || data;
				if (!Array.isArray(orgs)) {
					console.error('Organizations data not array:', orgs);
					return;
				}
				renderTable('tab-organizations', orgs, ['name', 'organizationType', 'contactEmail', 'address', 'approvalStatus', 'createdAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-organizations .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-organizations tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-organizations button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('organizations.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['Name', 'Type', 'Email', 'Location', 'Status', 'Created At'];
					const rows = document.querySelectorAll('#tab-organizations tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching organizations:', error);
			}
		}

		async function fetchAnnouncements() {
			try {
				const response = await apiFetch('/api/announcements');
				if (!response.ok) throw new Error('Failed to fetch announcements');
				const data = await response.json();
				const announcements = data.data?.announcements || data.data?.content || data.data || data;
				if (!Array.isArray(announcements)) {
					console.error('Announcements data not array:', announcements);
					return;
				}
				renderTable('tab-announcements', announcements, ['title', 'content', 'deadline', 'createdBy.name', 'status', 'collaborationType', 'createdAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-announcements .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-announcements tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-announcements button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('announcements.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['Title', 'Content', 'Date', 'Created By', 'Status', 'Priority', 'Created At'];
					const rows = document.querySelectorAll('#tab-announcements tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching announcements:', error);
			}
		}

		async function fetchCollaborationRequests() {
			try {
				const response = await apiFetch('/api/collaboration-requests/admin/all');
				if (!response.ok) throw new Error('Failed to fetch collaboration requests');
				const data = await response.json();
				const requests = data.data?.collaborationRequests || data.data?.content || data.data || data;
				if (!Array.isArray(requests)) {
					console.error('Collaboration requests data not array:', requests);
					return;
				}
				renderTable('tab-collaboration', requests, ['requestingUser.name', 'announcement.title', 'requestingOrganization.name', 'status', 'message', 'createdAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-collaboration .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-collaboration tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-collaboration button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('collaborationrequests.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['Requester', 'Project', 'Organization', 'Status', 'Message', 'Date'];
					const rows = document.querySelectorAll('#tab-collaboration tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching collaboration requests:', error);
			}
		}

		async function fetchPastProjects() {
			try {
				const response = await apiFetch('/api/past-projects');
				if (!response.ok) throw new Error('Failed to fetch past projects');
				const data = await response.json();
				const projects = data.data?.pastProjects || data.data?.content || data.data || data;
				if (!Array.isArray(projects)) {
					console.error('Past projects data not array:', projects);
					return;
				}
				renderTable('tab-pastprojects', projects, ['title', 'objectives', 'partner', 'projectCategory', 'finalStatus', 'budget', 'endDate', 'createdAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-pastprojects .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-pastprojects tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-pastprojects button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('pastprojects.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['Title', 'Objectives', 'Partner', 'Category', 'Status', 'Budget', 'End Date', 'Created At'];
					const rows = document.querySelectorAll('#tab-pastprojects tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching past projects:', error);
			}
		}

		async function fetchProjectReports() {
			try {
				const response = await apiFetch('/api/project-reports');
				if (!response.ok) throw new Error('Failed to fetch project reports');
				const data = await response.json();
				const reports = data.data?.projectReports || data.data?.content || data.data || data;
				if (!Array.isArray(reports)) {
					console.error('Project reports data not array:', reports);
					return;
				}
				renderTable('tab-projectreports', reports, ['title', 'project', 'submittedBy', 'reportType', 'reportStatus', 'submittedAt', 'createdAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-projectreports .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-projectreports tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-projectreports button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('projectreports.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['Title', 'Project', 'Submitted By', 'Type', 'Status', 'Submitted At', 'Created At'];
					const rows = document.querySelectorAll('#tab-projectreports tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching project reports:', error);
			}
		}

		async function fetchProjectCollaborators() {
			try {
				const response = await apiFetch('/api/projects/admin/collaborators');
				if (!response.ok) throw new Error('Failed to fetch project collaborators');
				const data = await response.json();
				const collaborators = data.data?.projectCollaborators || data.data?.content || data.data || data;
				if (!Array.isArray(collaborators)) {
					console.error('Project collaborators data not array:', collaborators);
					return;
				}
				renderTable('tab-collaborators', collaborators, ['user.name', 'project.title', 'organization.name', 'role', 'isActive', 'addedAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-collaborators .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-collaborators tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-collaborators button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('projectcollaborators.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['User', 'Project', 'Organization', 'Role', 'Status', 'Date Added'];
					const rows = document.querySelectorAll('#tab-collaborators tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching project collaborators:', error);
			}
		}

		async function fetchDashboardStats() {
			try {
				// Fetch projects for thematic areas, counties, budget
				const projectsResponse = await apiFetch('/api/projects');
				const projectsData = await projectsResponse.json();
				const projects = projectsData.data?.projects || projectsData.data?.content || projectsData.data || [];

				// Fetch users for partners count
				const usersResponse = await apiFetch('/api/auth/admin/users');
				const usersData = await usersResponse.json();
				const users = usersData.data?.users || usersData.data?.content || usersData.data || [];

				// Calculate stats
				const partnersCount = users.filter(user => user.role === 'PARTNER').length;
				const thematicAreas = new Set();
				const counties = new Set();
				let totalBudget = 0;

				projects.forEach(project => {
					if (project.themes) {
						project.themes.forEach(theme => thematicAreas.add(theme.code));
					}
					if (project.locations) {
						project.locations.forEach(location => counties.add(location.county));
					}
					if (project.budget) {
						totalBudget += parseFloat(project.budget) || 0;
					}
				});

				// Update counters
				document.getElementById('partners-count').textContent = partnersCount;
				document.getElementById('thematic-areas-count').textContent = thematicAreas.size;
				document.getElementById('counties-count').textContent = counties.size;
				document.getElementById('budget-count').innerHTML =
					`<span class="font-normal" style="font-size:0.5em;">KES</span> ${totalBudget.toLocaleString()}`;

			} catch (error) {
				console.error('Error fetching dashboard stats:', error);
			}
		}

		async function fetchProjectDocuments() {
			try {
				const response = await apiFetch('/api/project-documents');
				if (!response.ok) throw new Error('Failed to fetch project documents');
				const data = await response.json();
				const documents = data.data?.projectDocuments || data.data?.content || data.data || data;
				if (!Array.isArray(documents)) {
					console.error('Project documents data not array:', documents);
					return;
				}
				renderTable('tab-projectdocs', documents, ['fileName', 'project', 'uploadedBy', 'type', 'size', 'status', 'date', 'createdAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-projectdocs .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-projectdocs tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-projectdocs button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('projectdocuments.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['File Name', 'Project', 'Uploaded By', 'Type', 'Size', 'Status', 'Date', 'Created At'];
					const rows = document.querySelectorAll('#tab-projectdocs tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching project documents:', error);
			}
		}

		async function fetchUserDocuments() {
			try {
				const response = await apiFetch('/api/user-documents');
				if (!response.ok) throw new Error('Failed to fetch user documents');
				const data = await response.json();
				const documents = data.data?.userDocuments || data.data?.content || data.data || data;
				if (!Array.isArray(documents)) {
					console.error('User documents data not array:', documents);
					return;
				}
				renderTable('tab-userdocs', documents, ['fileName', 'user', 'uploadedBy', 'type', 'size', 'status', 'date', 'createdAt']);
				// Add column-wise search functionality
				const filterInputs = document.querySelectorAll('#tab-userdocs .filter-input');
				filterInputs.forEach(input => {
					input.addEventListener('input', filterTable);
				});
				function filterTable() {
					const rows = document.querySelectorAll('#tab-userdocs tbody tr');
					const filters = Array.from(filterInputs).map(input => input.value.toLowerCase());
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						let show = true;
						filters.forEach((filter, index) => {
							if (filter && cells[index] && !cells[index].textContent.toLowerCase().includes(filter)) {
								show = false;
							}
						});
						row.style.display = show ? '' : 'none';
					});
				}
				// Add export functionality
				const exportBtn = document.querySelector('#tab-userdocs button');
				if (exportBtn) {
					exportBtn.addEventListener('click', () => {
						exportTableToCSV('userdocuments.csv');
					});
				}
				function exportTableToCSV(filename) {
					const headers = ['File Name', 'User', 'Uploaded By', 'Type', 'Size', 'Status', 'Date', 'Created At'];
					const rows = document.querySelectorAll('#tab-userdocs tbody tr:not([style*="display: none"])');
					let csv = headers.join(',') + '\n';
					rows.forEach(row => {
						const cells = row.querySelectorAll('td');
						const rowData = Array.from(cells).slice(0, -1).map(cell => '"' + cell.textContent.replace(/"/g, '""') + '"');
						csv += rowData.join(',') + '\n';
					});
					const blob = new Blob([csv], { type: 'text/csv' });
					const url = URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.download = filename;
					a.click();
					URL.revokeObjectURL(url);
				}
			} catch (error) {
				console.error('Error fetching user documents:', error);
			}
		}

		document.addEventListener('DOMContentLoaded', function () {
			// Tab definitions by role
			const allTabs = [
				{ key: 'dashboard', label: 'Dashboard', icon: 'dashboard' },
				{ key: 'projects', label: 'Projects', icon: 'folder' },
				{ key: 'users', label: 'Users', icon: 'group' },
				{ key: 'organizations', label: 'Organizations', icon: 'apartment' },
				{ key: 'announcements', label: 'Announcements', icon: 'campaign' },
				{ key: 'collaboration', label: 'Collaboration Requests', icon: 'handshake' },
				{ key: 'pastprojects', label: 'Past Projects', icon: 'history' },
				{ key: 'projectdocs', label: 'Project Documents', icon: 'description' },
				{ key: 'projectreports', label: 'Project Reports', icon: 'assessment' },
				{ key: 'userdocs', label: 'User Documents', icon: 'badge' },
				{ key: 'collaborators', label: 'Project Collaborators', icon: 'groups' }
			];
			const roleTabs = {
				SUPER_ADMIN: allTabs,
				SUPER_ADMIN_APPROVER: allTabs,
				SUPER_ADMIN_REVIEWER: allTabs,
				DONOR: [
					allTabs[0], // Dashboard
					allTabs[1], // Projects
					allTabs[3], // Organizations
					allTabs[6], // Past Projects
					allTabs[7], // Project Documents
					allTabs[8], // Project Reports
					allTabs[10] // Project Collaborators
				],
				PARTNER: [
					allTabs[0], // Dashboard
					allTabs[1], // Projects
					allTabs[6], // Past Projects
					allTabs[7], // Project Documents
					allTabs[8], // Project Reports
					allTabs[10] // Project Collaborators
				]
			};
			// Get userRole from localStorage
			const userRole = localStorage.getItem('userRole') || 'SUPER_ADMIN_REVIEWER';
			const tabs = roleTabs[userRole] || roleTabs['PARTNER'];
			// Render sidebar tabs
			const sidebarTabsContainer = document.getElementById('sidebar-tabs');
			sidebarTabsContainer.innerHTML = '';
			tabs.forEach((tab, idx) => {
				const a = document.createElement('a');
				a.className = 'sidebar-tab flex items-center gap-3 px-3 py-2 rounded-lg text-neutral-text dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800';
				a.setAttribute('data-tab', tab.key);
				a.setAttribute('href', '#');
				a.innerHTML = `<span class="material-symbols-outlined">${tab.icon}</span><span class="text-sm font-medium">${tab.label}</span>`;
				if (idx === 0) {
					a.classList.add('bg-primary/10', 'text-primary', 'dark:bg-primary/20', 'dark:text-white');
				}
				sidebarTabsContainer.appendChild(a);
			});
			// Tab switching logic
			const sidebarTabs = document.querySelectorAll('.sidebar-tab');
			const tabSections = {
				dashboard: document.getElementById('tab-dashboard'),
				projects: document.getElementById('tab-projects'),
				users: document.getElementById('tab-users'),
				organizations: document.getElementById('tab-organizations'),
				announcements: document.getElementById('tab-announcements'),
				collaboration: document.getElementById('tab-collaboration'),
				pastprojects: document.getElementById('tab-pastprojects'),
				projectdocs: document.getElementById('tab-projectdocs'),
				projectreports: document.getElementById('tab-projectreports'),
				userdocs: document.getElementById('tab-userdocs'),
				collaborators: document.getElementById('tab-collaborators')
			};
			function showTab(tab) {
				Object.values(tabSections).forEach(section => {
					if (section) section.style.display = 'none';
				});
				if (tabSections[tab]) {
					tabSections[tab].style.display = '';
					if (tab === 'dashboard') fetchDashboardStats();
					else if (tab === 'projects') fetchProjects();
					else if (tab === 'users') fetchUsers();
					else if (tab === 'organizations') fetchOrganizations();
					else if (tab === 'announcements') fetchAnnouncements();
					else if (tab === 'pastprojects') fetchPastProjects();
					else if (tab === 'collaboration') fetchCollaborationRequests();
					else if (tab === 'projectreports') fetchProjectReports();
					else if (tab === 'collaborators') fetchProjectCollaborators();
					else if (tab === 'projectdocs') fetchProjectDocuments();
					else if (tab === 'userdocs') fetchUserDocuments();
				}
				sidebarTabs.forEach(btn => btn.classList.remove('bg-primary/10', 'text-primary', 'dark:bg-primary/20', 'dark:text-white'));
				const activeBtn = Array.from(sidebarTabs).find(btn => btn.getAttribute('data-tab') === tab);
				if (activeBtn) activeBtn.classList.add('bg-primary/10', 'text-primary', 'dark:bg-primary/20', 'dark:text-white');
			}
			sidebarTabs.forEach(btn => {
				btn.addEventListener('click', function (e) {
					e.preventDefault();
					const tab = btn.getAttribute('data-tab');
					showTab(tab);
				});
			});
			// Show first tab by default
			showTab(tabs[0].key);

			// Announcement modal handlers
			const createAnnouncementBtn = document.getElementById('create-announcement-btn');
			const createAnnouncementModal = document.getElementById('create-announcement-modal');
			const cancelAnnouncementBtn = document.getElementById('cancel-announcement-btn');
			const createAnnouncementForm = document.getElementById('create-announcement-form');

			createAnnouncementBtn.addEventListener('click', () => {
				createAnnouncementModal.classList.remove('hidden');
			});

			cancelAnnouncementBtn.addEventListener('click', () => {
				createAnnouncementModal.classList.add('hidden');
				createAnnouncementForm.reset();
			});

			createAnnouncementForm.addEventListener('submit', async (e) => {
				e.preventDefault();
				const title = document.getElementById('announcement-title').value;
				const content = document.getElementById('announcement-content').value;
				const deadline = document.getElementById('announcement-deadline').value;
				const collaborationType = document.getElementById('announcement-collaboration-type').value;

				try {
					const response = await apiFetch('/api/announcements', {
						method: 'POST',
						body: JSON.stringify({
							title,
							content,
							deadline: deadline || null,
							collaborationType
						})
					});
					if (response.ok) {
						alert('Announcement created successfully!');
						createAnnouncementModal.classList.add('hidden');
						createAnnouncementForm.reset();
						fetchAnnouncements(); // Refresh the table
					} else {
						alert('Failed to create announcement');
					}
				} catch (error) {
					console.error('Error creating announcement:', error);
					alert('Error creating announcement');
				}
			});
		});
	</script>
</body>

</html>